# 비주얼 노벨 엔진 - HTML 구현 계획

## 개요

메이플 월드 엔진 Lua 기반 비주얼 노벨을 최적화된 현대적인 HTML/CSS/JavaScript 웹 애플리케이션으로 변환합니다. 시스템에는 타이핑 효과가 있는 대화, 캐릭터 초상화, 배경, CG 이미지, 타임아웃이 있는 선택지, 저장/불러오기 기능, 다양한 전환 효과, 오디오 지원 등 포괄적인 기능이 포함됩니다.

## 사용자 확인 사항

> [!IMPORTANT]
> **데이터 소스**: 원본 코드는 `NPCTalk` DataService 테이블에서 데이터를 로드합니다. HTML 버전에서는 JSON 데이터 구조를 생성합니다.
> - 샘플 JSON 구조와 예제 대화 데이터 생성
> - 사용자가 나중에 데이터를 추가/수정할 수 있도록 구조화

> [!NOTE]
> **에셋 경로**: 원본은 이미지와 오디오에 RUID(리소스 고유 ID)를 사용합니다. HTML에서는 표준 파일 경로를 사용하며, 나중에 추가할 수 있도록 경로만 설정:
> - 배경 이미지 (backgrounds/)
> - 캐릭터 초상화 이미지 (portraits/)
> - CG 이미지 (cg/)
> - BGM 오디오 파일 (audio/bgm/)
> - SFX 오디오 파일 (audio/sfx/)
> - 팝업 이미지 (popup/)

## 변경 사항

### [신규] `index.html`

단일 페이지 애플리케이션 구조:
- 메인 메뉴 화면 (새 게임, 불러오기 버튼)
- 게임 UI 그룹 (대화 상자, 초상화, 배경, CG 레이어 등)
- 저장/불러오기 슬롯 패널 (메인 메뉴용, 인게임용)
- 타임아웃 표시가 있는 선택지 패널
- 인게임 저장/불러오기용 휴대전화 버튼 및 패널
- 점프/디버그 패널
- 팝업 이미지 오버레이
- 전환 효과용 흰색 페이드 오버레이

### [신규] `styles.css`

현대적이고 프리미엄 디자인 시스템:
- 그라데이션 오버레이와 글라스모피즘 효과가 있는 **다크 테마**
- 모든 전환을 위한 **부드러운 애니메이션**
- 화면 크기에 맞춰 조정되는 **반응형 레이아웃**
- 생동감 있는 강조색을 사용한 **풍부한 색상 팔레트**
- Google Fonts(예: Outfit, Inter)를 사용한 **맞춤 타이포그래피**
- **호버 효과** 및 미세 애니메이션
- 적절한 오버레이 관리를 위한 **Z-index 레이어링** 시스템

디자인 요소:
- 백드롭 블러 효과가 있는 글라스모피즘 대화 상자
- 호버 상태가 있는 그라데이션 버튼
- UI 요소를 위한 부드러운 페이드인 애니메이션
- 캐릭터 초상화 깊이 효과 (비활성 시 크기/불투명도 조정)
- 썸네일이 있는 우아한 저장 슬롯 카드
- 타이밍 표시기가 있는 세련된 선택지 버튼

### [신규] `visual-novel.js`

모듈식 아키텍처의 핵심 게임 엔진:

#### 데이터 관리
- JSON 기반 대화 데이터 로더
- 효율적인 조회를 위한 ID-인덱스 매핑
- LocalStorage 기반 저장/불러오기 시스템 (3개 슬롯)

#### 씬 컨트롤러
- 씬 흐름 관리
- 글자별 타이핑 효과가 있는 텍스트 표시
- 클릭/스페이스바로 타이핑 건너뛰기
- 타임아웃 타이머가 있는 선택지 처리
- 다음 씬으로 자동 진행

#### UI 매니저
- 동적 UI 상태 관리 (요소 표시/숨김)
- 초상화 위치 및 상태 (활성/비활성 시각 효과)
- 배경 및 CG 관리
- 패널 컨트롤 (메인 메뉴, 휴대전화, 슬롯, 점프)

#### 효과 엔진
- **페이드 전환**: 검은색/흰색 페이드 인/아웃
- **흔들림 효과**: 화면 및 개별 요소에 대한 설정 가능한 강도와 지속 시간
- **깜빡임/임팩트**: 화면 플래시 효과
- **초상화 흔들림**: 개별 캐릭터 흔들림
- 모든 애니메이션에 대한 **부드러운 보간**

#### 오디오 시스템
- 끊김 없는 전환이 있는 BGM 재생
- SFX 지원
- 성능을 위한 오디오 프리로딩

#### 저장/불러오기 시스템
- 썸네일 및 텍스트 미리보기가 있는 3개의 저장 슬롯
- 현재 씬 ID, 배경, 대화 텍스트 저장
- LocalStorage 지속성
- 미리보기 데이터로 슬롯 UI 업데이트

#### 입력 핸들러
- 대화 진행/타이핑 건너뛰기를 위한 스페이스바
- 버튼 및 선택지를 위한 클릭 이벤트
- 디버그 기능을 위한 키보드 단축키

## 데이터 구조

대화 데이터를 위한 예제 JSON 형식:

```json
{
  "scenes": [
    {
      "id": 1,
      "name": "Character Name",
      "text": "Dialog text here...",
      "portrait_1": "images/char1.png",
      "portrait_2": "",
      "main_portrait": "1",
      "background": "images/bg1.jpg",
      "cg": "",
      "popup": "",
      "bgm": "audio/bgm1.mp3",
      "sfx": "",
      "effect1": "fadeblackin",
      "effect_sec1": 1.0,
      "effect2": "",
      "effect_sec2": 0,
      "portraiteffect_1": "",
      "portraiteffect_2": "",
      "is_choice": 0,
      "next_id": 2
    },
    {
      "id": 2,
      "text": "This is a choice scene!",
      "is_choice": 1,
      "choice_01": "Option 1",
      "choice_02": "Option 2",
      "choice_03": "Option 3",
      "next_id_01": 3,
      "next_id_02": 4,
      "next_id_03": 5,
      "timeout_sec": 10,
      "timeout_next_id": 5
    }
  ]
}
```

## 최적화 전략

1. **에셋 프리로딩**: 끊김 방지를 위해 이미지와 오디오 미리 로드
2. **효율적인 렌더링**: 애니메이션에 CSS transform과 opacity 사용 (GPU 가속)
3. **이벤트 위임**: 동적 요소에 이벤트 위임 사용
4. **디바운싱**: 빠른 반복 동작 방지
5. **메모리 관리**: 사용하지 않는 에셋 정리, 타이머 적절히 취소
6. **RequestAnimationFrame**: 부드러운 흔들림 효과에 사용
7. **지연 로딩**: 대규모 프로젝트를 위한 온디맨드 에셋 로드

## 검증 계획

### 자동 테스트
- 샘플 대화 데이터 로드 및 파싱 확인
- localStorage 저장/불러오기 테스트
- 모든 효과 타입이 올바르게 렌더링되는지 확인
- 타임아웃이 있는 선택지 시스템 테스트

### 수동 확인
- 디자인 미학 시각적 검토
- 메인 메뉴에서 대화, 선택지까지 사용자 흐름 테스트
- 모든 전환이 부드러운지 확인
- 다양한 화면 크기에서 반응형 디자인 테스트
- 오디오 재생 확인
- 엣지 케이스 테스트 (빈 슬롯, 게임 종료 트리거, 빠른 클릭)
